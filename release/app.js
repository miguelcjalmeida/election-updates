(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var set_state_votes_1=require("../state/set-state-votes");exports.default={setStateVotes:set_state_votes_1.default}},{"../state/set-state-votes":16}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AppUpdater=void 0;var notify_of_updates_1=require("../updates/notify-of-updates");var did_any_vote_happen_1=require("../state/did-any-vote-happen");var get_state_name_1=require("../state/get-state-name");var get_state_votes_1=require("../state/get-state-votes");var get_state_updates_1=require("../updates/get-state-updates");var votes_cached_1=require("./votes-cached");var AppUpdater=function(){function AppUpdater(){}AppUpdater.prototype.start=function(){this.setInitialValues();this.keepCheckingForChanges()};AppUpdater.prototype.setInitialValues=function(){this.hasNewVotes=false;this.refreshListOfStates();this.stateElements.forEach(this.saveStateInCache.bind(this))};AppUpdater.prototype.refreshListOfStates=function(){this.stateElements=document.querySelectorAll(".fKE5Bb")};AppUpdater.prototype.saveStateInCache=function(state){var stateName=get_state_name_1.default(state);votes_cached_1.default[stateName]=[0,0]};AppUpdater.prototype.keepCheckingForChanges=function(){var _this=this;var repetition=function(){try{console.log("checking for new votes..");_this.checkForChanges()}catch(ex){console.log("Error checking for changes, trying again soon",ex)}};setTimeout(repetition.bind(this),1e3);setInterval(repetition.bind(this),6e4)};AppUpdater.prototype.checkForChanges=function(){this.refreshListOfStates();this.stateElements=document.querySelectorAll(".fKE5Bb");this.stateElements.forEach(this.checkForStateChanges.bind(this));if(this.hasNewVotes){notify_of_updates_1.default();this.hasNewVotes=false}};AppUpdater.prototype.checkForStateChanges=function(state){if(did_any_vote_happen_1.default(state)){console.log(get_state_updates_1.default(state));votes_cached_1.default[get_state_name_1.default(state)]=get_state_votes_1.default(state);this.hasNewVotes=true}};return AppUpdater}();exports.AppUpdater=AppUpdater},{"../state/did-any-vote-happen":6,"../state/get-state-name":11,"../state/get-state-votes":13,"../updates/get-state-updates":18,"../updates/notify-of-updates":19,"./votes-cached":3}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var cachedVotesByState={};exports.default=cachedVotesByState},{}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var globals_1=require("./app/globals");var updater_1=require("./app/updater");var appUpdater=new updater_1.AppUpdater;appUpdater.start();Object.assign(window,globals_1.default)},{"./app/globals":1,"./app/updater":2}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(votes1,votes2){return votes1[0]==votes2[0]&&votes1[1]===votes2[1]}},{}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var votes_cached_1=require("../app/votes-cached");var are_votes_equal_1=require("./are-votes-equal");var get_state_name_1=require("./get-state-name");var get_state_votes_1=require("./get-state-votes");exports.default=function(state){var stateName=get_state_name_1.default(state);var currentVotes=get_state_votes_1.default(state);var cacheVotes=votes_cached_1.default[stateName];return!are_votes_equal_1.default(currentVotes,cacheVotes)}},{"../app/votes-cached":3,"./are-votes-equal":5,"./get-state-name":11,"./get-state-votes":13}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var get_section_votes_1=require("./get-section-votes");var get_section_votes_perc_1=require("./get-section-votes-perc");exports.default=function(state){var votesColumn=state.querySelectorAll(":scope > div")[1];var bidenVoteSection=votesColumn.querySelectorAll(":scope > div")[0];var trumpVoteSection=votesColumn.querySelectorAll(":scope > div")[1];var bidenVotes=get_section_votes_1.default(bidenVoteSection);var trumpVotes=get_section_votes_1.default(trumpVoteSection);var bidenVotesPerc=get_section_votes_perc_1.default(bidenVoteSection);var trumpVotesPerc=get_section_votes_perc_1.default(trumpVoteSection);var bothVotesPerc=bidenVotesPerc+trumpVotesPerc;var bothVotes=bidenVotes+trumpVotes;return Math.round(bothVotes*100/bothVotesPerc)}},{"./get-section-votes":10,"./get-section-votes-perc":9}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var get_section_votes_1=require("./get-section-votes");exports.default=function(state){var votesColumn=state.querySelectorAll(":scope > div")[1];var bidenVoteSection=votesColumn.querySelectorAll(":scope > div")[0];return get_section_votes_1.default(bidenVoteSection)}},{"./get-section-votes":10}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(voteSection){var _a,_b;var voteLabel=voteSection.querySelectorAll(":scope > span")[0];if(!voteLabel)throw new Error("unable to find the vote percentage span in "+voteSection);return parseFloat((_b=(_a=voteLabel.textContent)===null||_a===void 0?void 0:_a.replace(/[\.\,]/g,".").replace("%",""))!==null&&_b!==void 0?_b:"0")}},{}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(voteSection){var _a,_b;var voteLabel=voteSection.querySelectorAll(":scope > span")[1];if(!voteLabel)throw new Error("unable to find the vote span in "+voteSection);return parseInt((_b=(_a=voteLabel.textContent)===null||_a===void 0?void 0:_a.replace(/[\.\,]/g,""))!==null&&_b!==void 0?_b:"0",10)}},{}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(state){var _a,_b;return(_b=(_a=state.querySelector(":scope > div > span"))===null||_a===void 0?void 0:_a.textContent)!==null&&_b!==void 0?_b:""}},{}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(state){var _a;var percentage=(_a=state.querySelector(".E2WDKf"))===null||_a===void 0?void 0:_a.textContent;if(!percentage)throw new Error("Could not retrieve given state percentage '"+state+"'");var match=percentage.match(/(\d+)%/);if(!match)throw new Error("Unable to recognize the percentage value for given state '"+state+"'");return parseInt(match[1])}},{}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var get_biden_votes_1=require("./get-biden-votes");var get_trump_votes_1=require("./get-trump-votes");exports.default=function(state){return[get_biden_votes_1.default(state),get_trump_votes_1.default(state)]}},{"./get-biden-votes":8,"./get-trump-votes":15}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(name){var _a;var stateName=document.evaluate('//span[text()="'+name+'"]',document,null,XPathResult.ANY_TYPE,null).iterateNext();var state=(_a=stateName===null||stateName===void 0?void 0:stateName.parentNode)===null||_a===void 0?void 0:_a.parentNode;if(!state)throw new Error("given state "+name+" was not found");return state}},{}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var get_section_votes_1=require("./get-section-votes");exports.default=function(state){var votesColumn=state.querySelectorAll(":scope > div")[1];var trumpVoteSection=votesColumn.querySelectorAll(":scope > div")[1];return get_section_votes_1.default(trumpVoteSection)}},{"./get-section-votes":10}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var get_state_1=require("./get-state");exports.default=function(name,vote1,vote2){var state=get_state_1.default(name);var votesColumn=state.querySelectorAll(":scope > div")[1];var bidenVoteSection=votesColumn.querySelectorAll(":scope > div")[0];var trumpVoteSection=votesColumn.querySelectorAll(":scope > div")[1];bidenVoteSection.querySelectorAll(":scope > span")[1].textContent=vote1;trumpVoteSection.querySelectorAll(":scope > span")[1].textContent=vote2}},{"./get-state":14}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var f=function(number){return number.toLocaleString()};exports.default=f},{}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var get_state_name_1=require("../state/get-state-name");var get_state_votes_1=require("../state/get-state-votes");var votes_cached_1=require("../app/votes-cached");var get_state_reported_votes_perc_1=require("../state/get-state-reported-votes-perc");var get_all_parties_votes_1=require("../state/get-all-parties-votes");var format_1=require("./format");exports.default=function(state){var biden="Biden";var trump="Trump";var stateName=get_state_name_1.default(state);var currentVotes=get_state_votes_1.default(state);var cachedVotes=votes_cached_1.default[stateName];var votesDiff=Math.abs(currentVotes[0]-currentVotes[1]);var isBidenWinning=currentVotes[0]>=currentVotes[1];var losingCandidate=isBidenWinning?trump:biden;var bidenNewVotes=currentVotes[0]-cachedVotes[0];var trumpNewVotes=currentVotes[1]-cachedVotes[1];var totalNewVotes=bidenNewVotes+trumpNewVotes;var trumpPercNewVotes=trumpNewVotes/totalNewVotes;var bidenPercNewVotes=bidenNewVotes/totalNewVotes;var loserDiffPercNewVote=isBidenWinning?trumpPercNewVotes-bidenPercNewVotes:bidenPercNewVotes-trumpPercNewVotes;var projectionInFloat=votesDiff/loserDiffPercNewVote;var projection=Math.round(projectionInFloat);var isProjectionVisible=isBidenWinning&&trumpNewVotes>bidenNewVotes||!isBidenWinning&&bidenNewVotes>trumpNewVotes;var reportedVotesPerc=get_state_reported_votes_perc_1.default(state);var unreportedVotesPerc=100-reportedVotesPerc;var allPartiesVotes=get_all_parties_votes_1.default(state);var estimatedMissingVotes=Math.round(allPartiesVotes-allPartiesVotes*reportedVotesPerc/100);var line1=stateName+" got new votes!";var line2=buildVoteLine(biden,cachedVotes[0],currentVotes[0]);var line3=buildVoteLine(trump,cachedVotes[1],currentVotes[1]);var line4=losingCandidate+" needs "+format_1.default(votesDiff)+" votes";var line5=stateName+" has yet to report up to "+format_1.default(estimatedMissingVotes)+" ("+format_1.default(unreportedVotesPerc)+"%) votes.";var line5Addendum="So far "+format_1.default(allPartiesVotes)+" ("+format_1.default(reportedVotesPerc)+"%) votes were counted";var line6=isProjectionVisible?"By projection, "+losingCandidate+" could be winning after "+format_1.default(projection)+" more votes counted":"";var line7=votesDiff>estimatedMissingVotes?"DONE! Race is over in the state of "+stateName+"\nBecause "+losingCandidate+" would need more votes than the amount left to count!":"";return line1+"\n"+line2+"\n"+line3+"\n"+line4+"\n"+line5+" "+line5Addendum+"\n"+line6+"\n"+line7};function buildVoteLine(candidate,oldVote,currentVote){var oldVoteFormatted=format_1.default(oldVote);var currentVoteFormatted=format_1.default(currentVote);var diffPrefix=currentVote>oldVote?"+":"";var diffFormatted=""+diffPrefix+format_1.default(currentVote-oldVote);return candidate+": "+oldVoteFormatted+" -> "+currentVoteFormatted+" ("+diffFormatted+")"}},{"../app/votes-cached":3,"../state/get-all-parties-votes":7,"../state/get-state-name":11,"../state/get-state-reported-votes-perc":12,"../state/get-state-votes":13,"./format":17}],19:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(){var sound=new Audio("https://freesound.org/data/previews/320/320654_5260872-lq.ogg");sound.play()}},{}]},{},[4]);
